{% extends 'base.html' %}

{% block head %}
<title>
    base57 | About
</title>
{% endblock %}

{% block body %}
  <div id="intro" class="doc-section">
      <h4 class="section-header">How it Works</h4>
      <p>The big idea of a URL shortener is simple: the server creates and retains a key-value pair between a <strong>number</strong> (the key) and a client's <strong>URL</strong> (the value). Upon creation, the server gives the key to the client. When a client eventually returns with the key, the server will fetch the corresponding value and redirect the client.</p>
      <p>This process can be summarized in three steps:</p>
      <ol>
          <li>A client gives the server a URL.</li>
          <li>The server creates a key-value pairing between a number (key) and the URL (value). It gives the key to the client.</li>
          <li>A client returns with the key. The server gives the corresponding value to the client.</li>
      </ol>
  </div>
  <div id="database-design" class="doc-section">
      <h4 class="section-header">Database Design</h4>
      <p>As you can probably guess from the description above, the server's database is not the most complicated thing in the world. All that is required is a two column table. One column for the numerical key and the other for the URL. The table may look something like this:</p>
      <table class="u-full-width">
          <thead>
              <tr>
                  <th>Key</th>
                  <th>URL</th>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td>0</td>
                  <td><a target="_blank" href="https://mathoverflow.net/questions/42512/awfully-sophisticated-proof-for-simple-facts">https://mathoverflow.net/questions/42512/awfully-sophisticated-proof-for-simple-facts</a></td>
              </tr>
              <tr>
                  <td>1</td>
                  <td><a target="_blank" href="https://projecteuler.net/problem=37">https://projecteuler.net/problem=37</a></td>
              </tr>
              <tr>
                  <td>2</td>
                  <td><a target="_blank" href="https://en.wikipedia.org/wiki/Narwhal#In_literature_and_art">https://en.wikipedia.org/wiki/Narwhal#In_literature_and_art</a></td>
              </tr>
          </tbody>
      </table>
      <p>So, when a client gives the server one of these URLs, does the server return a link like <a target="_blank" href="http://b57.xyz/1">http://b57.xyz/<strong>2</strong></a>? No. It returns a link like <a target="_blank" href="http://b57.xyz/8gPH">http://b57.xyz/<strong>8gPH</strong></a>. Why is it preferable to return seemingly random strings instead of integers? And where do these seemingly random strings come from?</p>
      <p>Frankly, every URL shortener has obfuscated shortlinks, so why not join the party? As to where these shortlinks come from...</p>
  </div>
  <div id="number-systems" class="doc-section">
      <h4 class="section-header">Number Systems</h4>
      <p>Most people write numbers using the ten symbols 0 - 9. This is commonly called the <em>decimal system</em> or <em>base ten</em>. But really, there's nothing stopping you from, say, replacing the symbol <em>4</em> with the symbol <em>W</em>. It may sound silly, but the world, all the people in it, and the universe in which it spins, would remain unchanged if you were to make such a proclamation.</p>
      <p>So let's do it. And let's change it from base ten to base fifty-seven.</p>
      <p>Let's use the fifty-seven symbols <code>23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</code> instead of the bland 0 - 9 nonsense we've been taught since we were kids. Let's take this to mean that the symbol <em>2</em> corresponds to the number zero, the symbol <em>3</em> corresponds to the number one, etc.</p>
      <p>As an exercise, try writing some of your favorite positive integers using base 57. Here are a few as well:</p>
      <ul>
          <li>The number 10 in base 57 is <em>C</em>.</li>
          <li>The number 57 in base 57 is <em>32</em>.</li>
          <li>The number 192 in base 57 is <em>5P</em>.</li>
      </ul>
      <p>In fact, these conversions could be written so they are all exactly four symbols long. (Why four? Why Not?) This can be done by <em>left-padding</em> the resulting base 57 representation with zeros (in our case, zero is the symbol <em>2</em>). For example, the above numbers could be written like so:</p>
      <ul>
          <li>The number 10 in base 57 is <em>222C</em>.</li>
          <li>The number 57 in base 57 is <em>2232</em>.</li>
          <li>The number 192 in base 57 is <em>225P</em>.</li>
      </ul>
      <p>This is no different than writing the base ten number 42 as 0042.</p>
      <p>At this point, you may begin to see how these shortlinks are generated. If we stopped here, we could rewrite the database table above to look something like this:</p>
      <table class="u-full-width">
          <thead>
              <tr>
                  <th>Key</th>
                  <th>
                      <div class="tooltip">
                          Shortlink<sup>*</sup>
                          <span class="tooltiptext">This column is not actually in the database. It is just here for demonstration.</span>
                      </div>
                  </th>
                  <th>URL</th>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td>0</td>
                  <td>2222</td>
                  <td><a target="_blank" href="https://mathoverflow.net/questions/42512/awfully-sophisticated-proof-for-simple-facts">https://mathoverflow.net/questions/42512/awfully-sophisticated-proof-for-simple-facts</a></td>
              </tr>
              <tr>
                  <td>1</td>
                  <td>2223</td>
                  <td><a target="_blank" href="https://projecteuler.net/problem=37">https://projecteuler.net/problem=37</a></td>
              </tr>
              <tr>
                  <td>2</td>
                  <td>2224</td>
                  <td><a target="_blank" href="https://en.wikipedia.org/wiki/Narwhal#In_literature_and_art">https://en.wikipedia.org/wiki/Narwhal#In_literature_and_art</a></td>
              </tr>
          </tbody>
      </table>
      <p>The above table spells out how the numerical keys are being converted into shortlinks. However, if this were to be the final result, anyone who has ever created a URL shortener would be laughing... <em>"Those shortlinks are so predictible!", "How tame!"</em>, they would tease. Well, we can do better.</p>
  </div>
  <div id="number-theory" class="doc-section">
      <h4 class="section-header">Number Theory</h4>
      <p>Although it would be easy to simply generate random strings for shortlinks, that would eventually end terribly. Suppose the server is already keeping track of a set of randomly generated shortlinks, say <em>S</em>, and the server is asked to generate a new shortlink, say <em>x<sub>0</sub></em>. Well, if <em>x<sub>0</sub></em> is already in <em>S</em>, the server must generate a new shortlink, <em>x<sub>1</sub></em>. But what if <em>x<sub>1</sub></em> is already in <em>S</em>? Uh-oh. Randomly generating shortlinks opens the possibility of taking an infinite amount of time to generate a single shortlink.</p>
      <p>So the question is, how can seemingly random shortlinks be generated while guaranteeing uniqueness among them? One solution to this lies in number theory in conjunction with base 57. (There is nothing particularly special about base 57 - except that I like it.)</p>
      <p>In the previous section, the shortlinks generated in the table follow a rather bland, predictible order. Our goal is to maintain predictability while simultaneously obfuscating the order to an outside observer. The order that the shortlinks follow in the above table can be defined by the 57 symbols and the relation that any shortlink is succeeded incrementally. We can therefore do two things:</p>
      <ol>
          <li>Reorder the symbols we use in base 57.</li>
          <li>Change the relation between successive shortlinks.</li>
      </ol>
      <p>To complete the first action, use instead a random scramble of those symbols, say <code>AyV4sDhXRfxuM3nP2pGHQzTYBJ86WidrjckoNELeKZb9vwagqUSm75FtC</code>.</p>
      <p>The shortlinks in the above table would then be represented as <em>AAAA, AAAy, AAAV</em>, respectively. While there is less predictability in determining the successive shortlink, the second action can still be taken to further obfuscate the shortlinks.</p>
      <p>Since there is an implicit commitment to using exactly 57 symbols to create shortlinks exactly 4 characters long, there are 57<sup>4</sup> = 10,556,001 possible shortlinks. Remember that the database key of each of these shortlinks is nothing more than one of the numbers from 0 to 57<sup>4</sup> - 1.</p>
      <p>In number theoretical terms, the set of numbers 0 through 57<sup>4</sup> - 1 forms a <a href="https://en.wikipedia.org/wiki/Modular_arithmetic#Residue_systems" target="_blank">complete residue system</a> modulo 57<sup>4</sup>. In short, this means that there are no two distinct numbers <em>x</em> and <em>y</em>, both in this set, that share the same remainder (residue) after being divided by 57<sup>4</sup>.</p>
      <p></p>
  </div>
{% endblock %}
